function diff_match_patch(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}define("common/templates/helpers",["lodash"],function(t){return{select:function(e,n){var r=t.keys(n.hash).map(function(t){return t+'="'+n.hash[t]+'"'}).join(" "),i="<select "+r+">",o=n.fn(this).replace(/value\s*=\s*("|')?([^><\b]*)\1/g,function(t,n,r){return r==e?t+" selected":t});return i+=o,i+="</select>"}}}),define("common/partials_compiled",["handlebars"],function(t){return this.JST=this.JST||{},t.registerPartial("common/footer",t.template(function(t,e,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{},'<div id="footer"><p class="copyright">Copyright â“’<a class="corp">NHN Corp.</a>All Rights Reserved.</p></div>'})),t.registerPartial("common/keybindings",t.template(function(t,e,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{},'<option value="">Ace</option>\r\n<option value="vim">Vim</option>\r\n<option value="emacs">Emacs</option>\r\n'})),t.registerPartial("common/languages",t.template(function(t,e,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{},'<option value="abap">ABAP</option>\r\n<option value="ada">ADA</option>\r\n<option value="actionscript">ActionScript</option>\r\n<option value="asciidoc">AsciiDoc</option>\r\n<option value="assembly_x86">Assembly_x86</option>\r\n<option value="autohotkey">AutoHotKey</option>\r\n<option value="batchfile">BatchFile</option>\r\n<option value="c9search">C9Search</option>\r\n<option value="c_cpp">C/C++</option>\r\n<option value="clojure">Clojure</option>\r\n<option value="cobol">Cobol</option>\r\n<option value="coffee">CoffeeScript</option>\r\n<option value="coldfusion">ColdFusion</option>\r\n<option value="csharp">C#</option>\r\n<option value="css">CSS</option>\r\n<option value="curly">Curly</option>\r\n<option value="d">D</option>\r\n<option value="dart">Dart</option>\r\n<option value="diff">Diff</option>\r\n<option value="dot">Dot</option>\r\n<option value="erlang">Erlang</option>\r\n<option value="ejs">EJS</option>\r\n<option value="forth">Forth</option>\r\n<option value="ftl">FreeMarker</option>\r\n<option value="glsl">Glsl</option>\r\n<option value="golang">Go</option>\r\n<option value="groovy">Groovy</option>\r\n<option value="haml">HAML</option>\r\n<option value="haskell">Haskell</option>\r\n<option value="haxe">haXe</option>\r\n<option value="html">HTML</option>\r\n<option value="html_ruby">HTML (Ruby)</option>\r\n<option value="ini">Ini</option>\r\n<option value="jade">Jade</option>\r\n<option value="java">Java</option>\r\n<option value="javascript">JavaScript</option>\r\n<option value="json">JSON</option>\r\n<option value="jsoniq">JSONiq</option>\r\n<option value="jsp">JSP</option>\r\n<option value="jsx">JSX</option>\r\n<option value="julia">Julia</option>\r\n<option value="latex">LaTeX</option>\r\n<option value="less">LESS</option>\r\n<option value="liquid">Liquid</option>\r\n<option value="lisp">Lisp</option>\r\n<option value="livescript">LiveScript</option>\r\n<option value="logiql">LogiQL</option>\r\n<option value="lsl">LSL</option>\r\n<option value="lua">Lua</option>\r\n<option value="luapage">LuaPage</option>\r\n<option value="lucene">Lucene</option>\r\n<option value="makefile">Makefile</option>\r\n<option value="matlab">MATLAB</option>\r\n<option value="markdown">Markdown</option>\r\n<option value="mysql">MySQL</option>\r\n<option value="mushcode">MUSHCode</option>\r\n<option value="objectivec">Objective-C</option>\r\n<option value="ocaml">OCaml</option>\r\n<option value="pascal">Pascal</option>\r\n<option value="perl">Perl</option>\r\n<option value="pgsql">pgSQL</option>\r\n<option value="php">PHP</option>\r\n<option value="powershell">Powershell</option>\r\n<option value="prolog">Prolog</option>\r\n<option value="properties">Properties</option>\r\n<option value="python">Python</option>\r\n<option value="r">R</option>\r\n<option value="rdoc">RDoc</option>\r\n<option value="rhtml">RHTML</option>\r\n<option value="ruby">Ruby</option>\r\n<option value="rust">Rust</option>\r\n<option value="sass">SASS</option>\r\n<option value="scad">SCAD</option>\r\n<option value="scala">Scala</option>\r\n<option value="scheme">Scheme</option>\r\n<option value="scss">SCSS</option>\r\n<option value="sh">SH</option>\r\n<option value="snippets">snippets</option>\r\n<option value="sql">SQL</option>\r\n<option value="stylus">Stylus</option>\r\n<option value="svg">SVG</option>\r\n<option value="tcl">Tcl</option>\r\n<option value="tex">Tex</option>\r\n<option value="text">Text</option>\r\n<option value="textile">Textile</option>\r\n<option value="toml">Toml</option>\r\n<option value="twig">Twig</option>\r\n<option value="typescript">Typescript</option>\r\n<option value="vbscript">VBScript</option>\r\n<option value="velocity">Velocity</option>\r\n<option value="xml">XML</option>\r\n<option value="xquery">XQuery</option>\r\n<option value="yaml">YAML</option>\r\n'})),t.registerPartial("common/themes",t.template(function(t,e,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{},'<optgroup label="Bright">\r\n    <option value="ace/theme/chrome">Chrome</option>\r\n    <option value="ace/theme/clouds">Clouds</option>\r\n    <option value="ace/theme/crimson_editor">Crimson Editor</option>\r\n    <option value="ace/theme/dawn">Dawn</option>\r\n    <option value="ace/theme/dreamweaver">Dreamweaver</option>\r\n    <option value="ace/theme/eclipse">Eclipse</option>\r\n    <option value="ace/theme/github">GitHub</option>\r\n    <option value="ace/theme/solarized_light">Solarized Light</option>\r\n    <option value="ace/theme/textmate" selected="selected">TextMate</option>\r\n    <option value="ace/theme/tomorrow">Tomorrow</option>\r\n    <option value="ace/theme/xcode">XCode</option>\r\n</optgroup>\r\n<optgroup label="Dark">\r\n    <option value="ace/theme/ambiance">Ambiance</option>\r\n    <option value="ace/theme/chaos">Chaos</option>\r\n    <option value="ace/theme/clouds_midnight">Clouds Midnight</option>\r\n    <option value="ace/theme/cobalt">Cobalt</option>\r\n    <option value="ace/theme/idle_fingers">idleFingers</option>\r\n    <option value="ace/theme/kr_theme">krTheme</option>\r\n    <option value="ace/theme/merbivore">Merbivore</option>\r\n    <option value="ace/theme/merbivore_soft">Merbivore Soft</option>\r\n    <option value="ace/theme/mono_industrial">Mono Industrial</option>\r\n    <option value="ace/theme/monokai">Monokai</option>\r\n    <option value="ace/theme/pastel_on_dark">Pastel on dark</option>\r\n    <option value="ace/theme/solarized_dark">Solarized Dark</option>\r\n    <option value="ace/theme/terminal">Terminal</option>\r\n    <option value="ace/theme/tomorrow_night">Tomorrow Night</option>\r\n    <option value="ace/theme/tomorrow_night_blue">Tomorrow Night Blue</option>\r\n    <option value="ace/theme/tomorrow_night_bright">Tomorrow Night Bright</option>\r\n    <option value="ace/theme/tomorrow_night_eighties">Tomorrow Night 80s</option>\r\n    <option value="ace/theme/twilight">Twilight</option>    \r\n    <option value="ace/theme/vibrant_ink">Vibrant Ink</option>\r\n</optgroup>\r\n'})),this.JST}),define("common/templates_compiled",["handlebars"],function(t){return this.JST=this.JST||{},this.JST["common/alert"]=t.template(function(t,e,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{};var o,a="",s="function",c=this.escapeExpression;return a+='<div class="alert alert-',(o=n.type)?o=o.call(e,{hash:{},data:i}):(o=e.type,o=typeof o===s?o.apply(e):o),a+=c(o)+" ",(o=n.custClass)?o=o.call(e,{hash:{},data:i}):(o=e.custClass,o=typeof o===s?o.apply(e):o),a+=c(o)+' fade in" id="',(o=n.id)?o=o.call(e,{hash:{},data:i}):(o=e.id,o=typeof o===s?o.apply(e):o),a+=c(o)+'">\r\n	<button type="button" data-dismiss="alert" class="close">&times;</button>\r\n	<span>',(o=n.msg)?o=o.call(e,{hash:{},data:i}):(o=e.msg,o=typeof o===s?o.apply(e):o),a+=c(o)+"</span>\r\n</div>\r\n"}),this.JST["common/modal"]=t.template(function(t,e,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{};var o,a="",s="function",c=this.escapeExpression;return a+='  <!-- Modal -->\r\n<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">\r\n  <div class="modal-dialog">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\r\n        <h4 class="modal-title">',(o=n.title)?o=o.call(e,{hash:{},data:i}):(o=e.title,o=typeof o===s?o.apply(e):o),a+=c(o)+'</h4>\r\n      </div>\r\n      <div class="modal-body">\r\n        ',(o=n.body)?o=o.call(e,{hash:{},data:i}):(o=e.body,o=typeof o===s?o.apply(e):o),(o||0===o)&&(a+=o),a+='\r\n      </div>\r\n      <div class="modal-footer">\r\n        ',(o=n.footer)?o=o.call(e,{hash:{},data:i}):(o=e.footer,o=typeof o===s?o.apply(e):o),(o||0===o)&&(a+=o),a+="\r\n      </div>\r\n    </div><!-- /.modal-content -->\r\n  </div><!-- /.modal-dialog -->\r\n</div><!-- /.modal -->\r\n"}),this.JST}),define("common/templates/main",["handlebars","./helpers","common/partials_compiled","common/templates_compiled","lodash"],function(t,e,n,r,i){return i.each(e||[],function(e,n){t.registerHelper(n,e)}),r}),define("common/templates",["common/templates/main"],function(t){return t}),define("edit/templates_compiled",["handlebars"],function(t){return this.JST=this.JST||{},this.JST.edit=t.template(function(t,e,n,r,i){function o(t,e){var i,o="";return o+="\r\n					",i=h.invokePartial(r["common/languages"],"common/languages",t,n,r,e),(i||0===i)&&(o+=i),o+="\r\n				"}function a(t,e){var i,o="";return o+="\r\n					",i=h.invokePartial(r["common/keybindings"],"common/keybindings",t,n,r,e),(i||0===i)&&(o+=i),o+="\r\n				"}function s(t,e){var i,o="";return o+="\r\n					",i=h.invokePartial(r["common/themes"],"common/themes",t,n,r,e),(i||0===i)&&(o+=i),o+="\r\n				"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),r=this.merge(r,t.partials),i=i||{};var c,l,u,p="",h=this,f="function",d=this.escapeExpression,m=n.helperMissing;return p+='<div id="header" class="navbar navbar-inverse navbar-fixed-top edit-header" role="banner">\r\n	<div class="container">\r\n		<div class="navbar-header">\r\n			<a class="navbar-brand" href="#">RealEdit</a>\r\n		</div>\r\n		<div class="collapse navbar-collapse navbar-ex2-collapse">\r\n			<button type="button" class="btn btn-default navbar-btn btn-xs">New</button>\r\n			<button type="button" class="btn btn-default btn-xs">History</button>\r\n			<button type="button" class="btn btn-default btn-xs">Download</button>\r\n			<div class="user-info pull-right">\r\n				<a href="#" id="userName">',(c=n.user)?c=c.call(e,{hash:{},data:i}):(c=e.user,c=typeof c===f?c.apply(e):c),p+=d(c)+'</a>\r\n			</div>\r\n\r\n			<div class="pro-lang pull-right">\r\n				<span>Languages</span>\r\n				',u={hash:{id:"progLang"},inverse:h.noop,fn:h.program(1,o,i),data:i},c=n.select||e.select,l=c?c.call(e,e.language,u):m.call(e,"select",e.language,u),(l||0===l)&&(p+=l),p+='\r\n			</div>\r\n\r\n			<div class="key-binding pull-right">\r\n				<span>Key Binding</span>\r\n				',u={hash:{id:"keyBinding"},inverse:h.noop,fn:h.program(3,a,i),data:i},c=n.select||e.select,l=c?c.call(e,e.keybindi,u):m.call(e,"select",e.keybindi,u),(l||0===l)&&(p+=l),p+='\r\n			</div>\r\n\r\n			<div class="editor-theme pull-right">\r\n				<span>Theme</span>\r\n				',u={hash:{id:"editorTheme"},inverse:h.noop,fn:h.program(5,s,i),data:i},c=n.select||e.select,l=c?c.call(e,e.theme,u):m.call(e,"select",e.theme,u),(l||0===l)&&(p+=l),p+='\r\n			</div>\r\n        </div>\r\n\r\n		\r\n	</div>\r\n</div>\r\n\r\n<div id="editCon" class="container">\r\n	<div class="clearfix row" style="position:relative">\r\n		<div class="sidebar col-xs-3">\r\n			<div class="user-list panel panel-default">\r\n				<div class="panel-heading">\r\n					Users <span class="badge" id="userNum">42</span>\r\n				</div>\r\n				<div class="panel-body">\r\n					<ul id="usersList">\r\n					</ul>\r\n\r\n					<div class="always-into-view"></div>\r\n				</div>\r\n			</div>\r\n\r\n			<div class="messages panel panel-default">\r\n				<div class="panel-heading">\r\n					Messages\r\n				</div>\r\n				<div class="panel-body">\r\n					<ul id="msgList">\r\n					</ul>\r\n					\r\n					<div class="always-into-view"></div>\r\n				</div>\r\n			</div>\r\n\r\n			<div class="chat-con panel panel-default">\r\n				<div class="panel-heading">\r\n					Chat\r\n				</div>\r\n				<div class="panel-body">\r\n					<input id="message" type="text" class="form-control">\r\n				</div>\r\n			</div>\r\n		</div>\r\n		<div id="editor" class="col-xs-9"></div>\r\n	</div>\r\n</div>\r\n'}),this.JST["edit/message"]=t.template(function(t,e,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{};var o,a="",s="function",c=this.escapeExpression;return a+="<li>\n	<span>",(o=n.user)?o=o.call(e,{hash:{},data:i}):(o=e.user,o=typeof o===s?o.apply(e):o),a+=c(o)+":</span>\n	<br>\n	<span>",(o=n.msg)?o=o.call(e,{hash:{},data:i}):(o=e.msg,o=typeof o===s?o.apply(e):o),a+=c(o)+"</span>\n</li>\n"}),this.JST["edit/users"]=t.template(function(t,e,n,r,i){function o(t,e){var r,i="";return i+="\n	<li>",(r=n.user)?r=r.call(t,{hash:{},data:e}):(r=t.user,r=typeof r===c?r.apply(t):r),i+=l(r)+" <span>"+l((r=t.address,r=null==r||r===!1?r:r.address,typeof r===c?r.apply(t):r))+"</span><li>\n"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{};var a,s="",c="function",l=this.escapeExpression,u=this;return a=n.each.call(e,e.users,{hash:{},inverse:u.noop,fn:u.program(1,o,i),data:i}),(a||0===a)&&(s+=a),s+="\n"}),this.JST}),define("edit/templates/main",["handlebars","common/templates","edit/templates_compiled","lodash"],function(t,e,n){return n}),define("edit/templates",["edit/templates/main"],function(t){return t}),define("common/ModalView",["backbone","common/templates"],function(t,e){var n=t.View.extend({template:e["common/modal"],initialize:function(t){this.title=t.title,this.body=t.body,this.footer=t.footer,this.render()},render:function(){this.$el.html(this.template({title:this.title,body:this.body,footer:this.footer})),$(document.body).append(this.$el),this.$(".modal").modal()}});return n}),define("common/PromptView",["common/ModalView"],function(t){var e=t.extend({events:{"click .btn-ok":"ok","click .btn-close":"cancel"},initialize:function(t){this.title=t.title||"",this.body=(t.prompt||"")+'<br><br><input type="text" class="prompt-input">',this.footer='<button type="button" class="btn btn-close btn-default" data-dismiss="modal">Close</button><button type="button" class="btn btn-ok btn-primary" data-dismiss="modal">OK</button>',this.render(),this.$(".prompt-input").focus()},ok:function(){this.options.callback&&this.options.callback(this.$(".prompt-input").val())},cancel:function(){this.options.callback&&this.options.callback(null)}});return e});var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff,diff_match_patch.prototype.diff_main=function(t,e,n,r){"undefined"==typeof r&&(r=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var i=r;if(null==t||null==e)throw new Error("Null input. (diff_main)");if(t==e)return t?[[DIFF_EQUAL,t]]:[];"undefined"==typeof n&&(n=!0);var o=n,a=this.diff_commonPrefix(t,e),s=t.substring(0,a);t=t.substring(a),e=e.substring(a),a=this.diff_commonSuffix(t,e);var c=t.substring(t.length-a);t=t.substring(0,t.length-a),e=e.substring(0,e.length-a);var l=this.diff_compute_(t,e,o,i);return s&&l.unshift([DIFF_EQUAL,s]),c&&l.push([DIFF_EQUAL,c]),this.diff_cleanupMerge(l),l},diff_match_patch.prototype.diff_compute_=function(t,e,n,r){var i;if(!t)return[[DIFF_INSERT,e]];if(!e)return[[DIFF_DELETE,t]];var o=t.length>e.length?t:e,a=t.length>e.length?e:t,s=o.indexOf(a);if(-1!=s)return i=[[DIFF_INSERT,o.substring(0,s)],[DIFF_EQUAL,a],[DIFF_INSERT,o.substring(s+a.length)]],t.length>e.length&&(i[0][0]=i[2][0]=DIFF_DELETE),i;if(1==a.length)return[[DIFF_DELETE,t],[DIFF_INSERT,e]];var c=this.diff_halfMatch_(t,e);if(c){var l=c[0],u=c[1],p=c[2],h=c[3],f=c[4],d=this.diff_main(l,p,n,r),m=this.diff_main(u,h,n,r);return d.concat([[DIFF_EQUAL,f]],m)}return n&&t.length>100&&e.length>100?this.diff_lineMode_(t,e,r):this.diff_bisect_(t,e,r)},diff_match_patch.prototype.diff_lineMode_=function(t,e,n){var r=this.diff_linesToChars_(t,e);t=r.chars1,e=r.chars2;var i=r.lineArray,o=this.diff_main(t,e,!1,n);this.diff_charsToLines_(o,i),this.diff_cleanupSemantic(o),o.push([DIFF_EQUAL,""]);for(var a=0,s=0,c=0,l="",u="";a<o.length;){switch(o[a][0]){case DIFF_INSERT:c++,u+=o[a][1];break;case DIFF_DELETE:s++,l+=o[a][1];break;case DIFF_EQUAL:if(s>=1&&c>=1){o.splice(a-s-c,s+c),a=a-s-c;for(var r=this.diff_main(l,u,!1,n),p=r.length-1;p>=0;p--)o.splice(a,0,r[p]);a+=r.length}c=0,s=0,l="",u=""}a++}return o.pop(),o},diff_match_patch.prototype.diff_bisect_=function(t,e,n){for(var r=t.length,i=e.length,o=Math.ceil((r+i)/2),a=o,s=2*o,c=new Array(s),l=new Array(s),u=0;s>u;u++)c[u]=-1,l[u]=-1;c[a+1]=0,l[a+1]=0;for(var p=r-i,h=0!=p%2,f=0,d=0,m=0,g=0,v=0;o>v&&!((new Date).getTime()>n);v++){for(var y=-v+f;v-d>=y;y+=2){var b,x=a+y;b=y==-v||y!=v&&c[x-1]<c[x+1]?c[x+1]:c[x-1]+1;for(var w=b-y;r>b&&i>w&&t.charAt(b)==e.charAt(w);)b++,w++;if(c[x]=b,b>r)d+=2;else if(w>i)f+=2;else if(h){var _=a+p-y;if(_>=0&&s>_&&-1!=l[_]){var k=r-l[_];if(b>=k)return this.diff_bisectSplit_(t,e,b,w,n)}}}for(var E=-v+m;v-g>=E;E+=2){var k,_=a+E;k=E==-v||E!=v&&l[_-1]<l[_+1]?l[_+1]:l[_-1]+1;for(var T=k-E;r>k&&i>T&&t.charAt(r-k-1)==e.charAt(i-T-1);)k++,T++;if(l[_]=k,k>r)g+=2;else if(T>i)m+=2;else if(!h){var x=a+p-E;if(x>=0&&s>x&&-1!=c[x]){var b=c[x],w=a+b-x;if(k=r-k,b>=k)return this.diff_bisectSplit_(t,e,b,w,n)}}}}return[[DIFF_DELETE,t],[DIFF_INSERT,e]]},diff_match_patch.prototype.diff_bisectSplit_=function(t,e,n,r,i){var o=t.substring(0,n),a=e.substring(0,r),s=t.substring(n),c=e.substring(r),l=this.diff_main(o,a,!1,i),u=this.diff_main(s,c,!1,i);return l.concat(u)},diff_match_patch.prototype.diff_linesToChars_=function(t,e){function n(t){for(var e="",n=0,o=-1,a=r.length;o<t.length-1;){o=t.indexOf("\n",n),-1==o&&(o=t.length-1);var s=t.substring(n,o+1);n=o+1,(i.hasOwnProperty?i.hasOwnProperty(s):void 0!==i[s])?e+=String.fromCharCode(i[s]):(e+=String.fromCharCode(a),i[s]=a,r[a++]=s)}return e}var r=[],i={};r[0]="";var o=n(t),a=n(e);return{chars1:o,chars2:a,lineArray:r}},diff_match_patch.prototype.diff_charsToLines_=function(t,e){for(var n=0;n<t.length;n++){for(var r=t[n][1],i=[],o=0;o<r.length;o++)i[o]=e[r.charCodeAt(o)];t[n][1]=i.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(t,e){if(!t||!e||t.charAt(0)!=e.charAt(0))return 0;for(var n=0,r=Math.min(t.length,e.length),i=r,o=0;i>n;)t.substring(o,i)==e.substring(o,i)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i},diff_match_patch.prototype.diff_commonSuffix=function(t,e){if(!t||!e||t.charAt(t.length-1)!=e.charAt(e.length-1))return 0;for(var n=0,r=Math.min(t.length,e.length),i=r,o=0;i>n;)t.substring(t.length-i,t.length-o)==e.substring(e.length-i,e.length-o)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i},diff_match_patch.prototype.diff_commonOverlap_=function(t,e){var n=t.length,r=e.length;if(0==n||0==r)return 0;n>r?t=t.substring(n-r):r>n&&(e=e.substring(0,n));var i=Math.min(n,r);if(t==e)return i;for(var o=0,a=1;;){var s=t.substring(i-a),c=e.indexOf(s);if(-1==c)return o;a+=c,(0==c||t.substring(i-a)==e.substring(0,a))&&(o=a,a++)}},diff_match_patch.prototype.diff_halfMatch_=function(t,e){function n(t,e,n){for(var r,i,o,s,c=t.substring(n,n+Math.floor(t.length/4)),l=-1,u="";-1!=(l=e.indexOf(c,l+1));){var p=a.diff_commonPrefix(t.substring(n),e.substring(l)),h=a.diff_commonSuffix(t.substring(0,n),e.substring(0,l));u.length<h+p&&(u=e.substring(l-h,l)+e.substring(l,l+p),r=t.substring(0,n-h),i=t.substring(n+p),o=e.substring(0,l-h),s=e.substring(l+p))}return 2*u.length>=t.length?[r,i,o,s,u]:null}if(this.Diff_Timeout<=0)return null;var r=t.length>e.length?t:e,i=t.length>e.length?e:t;if(r.length<4||2*i.length<r.length)return null;var o,a=this,s=n(r,i,Math.ceil(r.length/4)),c=n(r,i,Math.ceil(r.length/2));if(!s&&!c)return null;o=c?s?s[4].length>c[4].length?s:c:c:s;var l,u,p,h;t.length>e.length?(l=o[0],u=o[1],p=o[2],h=o[3]):(p=o[0],h=o[1],l=o[2],u=o[3]);var f=o[4];return[l,u,p,h,f]},diff_match_patch.prototype.diff_cleanupSemantic=function(t){for(var e=!1,n=[],r=0,i=null,o=0,a=0,s=0,c=0,l=0;o<t.length;)t[o][0]==DIFF_EQUAL?(n[r++]=o,a=c,s=l,c=0,l=0,i=t[o][1]):(t[o][0]==DIFF_INSERT?c+=t[o][1].length:l+=t[o][1].length,i&&i.length<=Math.max(a,s)&&i.length<=Math.max(c,l)&&(t.splice(n[r-1],0,[DIFF_DELETE,i]),t[n[r-1]+1][0]=DIFF_INSERT,r--,r--,o=r>0?n[r-1]:-1,a=0,s=0,c=0,l=0,i=null,e=!0)),o++;for(e&&this.diff_cleanupMerge(t),this.diff_cleanupSemanticLossless(t),o=1;o<t.length;){if(t[o-1][0]==DIFF_DELETE&&t[o][0]==DIFF_INSERT){var u=t[o-1][1],p=t[o][1],h=this.diff_commonOverlap_(u,p),f=this.diff_commonOverlap_(p,u);h>=f?(h>=u.length/2||h>=p.length/2)&&(t.splice(o,0,[DIFF_EQUAL,p.substring(0,h)]),t[o-1][1]=u.substring(0,u.length-h),t[o+1][1]=p.substring(h),o++):(f>=u.length/2||f>=p.length/2)&&(t.splice(o,0,[DIFF_EQUAL,u.substring(0,f)]),t[o-1][0]=DIFF_INSERT,t[o-1][1]=p.substring(0,p.length-f),t[o+1][0]=DIFF_DELETE,t[o+1][1]=u.substring(f),o++),o++}o++}},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(t){function e(t,e){if(!t||!e)return 6;var n=t.charAt(t.length-1),r=e.charAt(0),i=n.match(diff_match_patch.nonAlphaNumericRegex_),o=r.match(diff_match_patch.nonAlphaNumericRegex_),a=i&&n.match(diff_match_patch.whitespaceRegex_),s=o&&r.match(diff_match_patch.whitespaceRegex_),c=a&&n.match(diff_match_patch.linebreakRegex_),l=s&&r.match(diff_match_patch.linebreakRegex_),u=c&&t.match(diff_match_patch.blanklineEndRegex_),p=l&&e.match(diff_match_patch.blanklineStartRegex_);return u||p?5:c||l?4:i&&!a&&s?3:a||s?2:i||o?1:0}for(var n=1;n<t.length-1;){if(t[n-1][0]==DIFF_EQUAL&&t[n+1][0]==DIFF_EQUAL){var r=t[n-1][1],i=t[n][1],o=t[n+1][1],a=this.diff_commonSuffix(r,i);if(a){var s=i.substring(i.length-a);r=r.substring(0,r.length-a),i=s+i.substring(0,i.length-a),o=s+o}for(var c=r,l=i,u=o,p=e(r,i)+e(i,o);i.charAt(0)===o.charAt(0);){r+=i.charAt(0),i=i.substring(1)+o.charAt(0),o=o.substring(1);var h=e(r,i)+e(i,o);h>=p&&(p=h,c=r,l=i,u=o)}t[n-1][1]!=c&&(c?t[n-1][1]=c:(t.splice(n-1,1),n--),t[n][1]=l,u?t[n+1][1]=u:(t.splice(n+1,1),n--))}n++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupEfficiency=function(t){for(var e=!1,n=[],r=0,i=null,o=0,a=!1,s=!1,c=!1,l=!1;o<t.length;)t[o][0]==DIFF_EQUAL?(t[o][1].length<this.Diff_EditCost&&(c||l)?(n[r++]=o,a=c,s=l,i=t[o][1]):(r=0,i=null),c=l=!1):(t[o][0]==DIFF_DELETE?l=!0:c=!0,i&&(a&&s&&c&&l||i.length<this.Diff_EditCost/2&&3==a+s+c+l)&&(t.splice(n[r-1],0,[DIFF_DELETE,i]),t[n[r-1]+1][0]=DIFF_INSERT,r--,i=null,a&&s?(c=l=!0,r=0):(r--,o=r>0?n[r-1]:-1,c=l=!1),e=!0)),o++;e&&this.diff_cleanupMerge(t)},diff_match_patch.prototype.diff_cleanupMerge=function(t){t.push([DIFF_EQUAL,""]);for(var e,n=0,r=0,i=0,o="",a="";n<t.length;)switch(t[n][0]){case DIFF_INSERT:i++,a+=t[n][1],n++;break;case DIFF_DELETE:r++,o+=t[n][1],n++;break;case DIFF_EQUAL:r+i>1?(0!==r&&0!==i&&(e=this.diff_commonPrefix(a,o),0!==e&&(n-r-i>0&&t[n-r-i-1][0]==DIFF_EQUAL?t[n-r-i-1][1]+=a.substring(0,e):(t.splice(0,0,[DIFF_EQUAL,a.substring(0,e)]),n++),a=a.substring(e),o=o.substring(e)),e=this.diff_commonSuffix(a,o),0!==e&&(t[n][1]=a.substring(a.length-e)+t[n][1],a=a.substring(0,a.length-e),o=o.substring(0,o.length-e))),0===r?t.splice(n-i,r+i,[DIFF_INSERT,a]):0===i?t.splice(n-r,r+i,[DIFF_DELETE,o]):t.splice(n-r-i,r+i,[DIFF_DELETE,o],[DIFF_INSERT,a]),n=n-r-i+(r?1:0)+(i?1:0)+1):0!==n&&t[n-1][0]==DIFF_EQUAL?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,i=0,r=0,o="",a=""}""===t[t.length-1][1]&&t.pop();var s=!1;for(n=1;n<t.length-1;)t[n-1][0]==DIFF_EQUAL&&t[n+1][0]==DIFF_EQUAL&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)==t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),s=!0):t[n][1].substring(0,t[n+1][1].length)==t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),s=!0)),n++;s&&this.diff_cleanupMerge(t)},diff_match_patch.prototype.diff_xIndex=function(t,e){var n,r=0,i=0,o=0,a=0;for(n=0;n<t.length&&(t[n][0]!==DIFF_INSERT&&(r+=t[n][1].length),t[n][0]!==DIFF_DELETE&&(i+=t[n][1].length),!(r>e));n++)o=r,a=i;return t.length!=n&&t[n][0]===DIFF_DELETE?a:a+(e-o)},diff_match_patch.prototype.diff_prettyHtml=function(t){for(var e=[],n=/&/g,r=/</g,i=/>/g,o=/\n/g,a=0;a<t.length;a++){var s=t[a][0],c=t[a][1],l=c.replace(n,"&amp;").replace(r,"&lt;").replace(i,"&gt;").replace(o,"&para;<br>");switch(s){case DIFF_INSERT:e[a]='<ins style="background:#e6ffe6;">'+l+"</ins>";break;case DIFF_DELETE:e[a]='<del style="background:#ffe6e6;">'+l+"</del>";break;case DIFF_EQUAL:e[a]="<span>"+l+"</span>"}}return e.join("")},diff_match_patch.prototype.diff_text1=function(t){for(var e=[],n=0;n<t.length;n++)t[n][0]!==DIFF_INSERT&&(e[n]=t[n][1]);return e.join("")},diff_match_patch.prototype.diff_text2=function(t){for(var e=[],n=0;n<t.length;n++)t[n][0]!==DIFF_DELETE&&(e[n]=t[n][1]);return e.join("")},diff_match_patch.prototype.diff_levenshtein=function(t){for(var e=0,n=0,r=0,i=0;i<t.length;i++){var o=t[i][0],a=t[i][1];switch(o){case DIFF_INSERT:n+=a.length;break;case DIFF_DELETE:r+=a.length;break;case DIFF_EQUAL:e+=Math.max(n,r),n=0,r=0}}return e+=Math.max(n,r)},diff_match_patch.prototype.diff_toDelta=function(t){for(var e=[],n=0;n<t.length;n++)switch(t[n][0]){case DIFF_INSERT:e[n]="+"+encodeURI(t[n][1]);break;case DIFF_DELETE:e[n]="-"+t[n][1].length;break;case DIFF_EQUAL:e[n]="="+t[n][1].length}return e.join("	").replace(/%20/g," ")},diff_match_patch.prototype.diff_fromDelta=function(t,e){for(var n=[],r=0,i=0,o=e.split(/\t/g),a=0;a<o.length;a++){var s=o[a].substring(1);switch(o[a].charAt(0)){case"+":try{n[r++]=[DIFF_INSERT,decodeURI(s)]}catch(c){throw new Error("Illegal escape in diff_fromDelta: "+s)}break;case"-":case"=":var l=parseInt(s,10);if(isNaN(l)||0>l)throw new Error("Invalid number in diff_fromDelta: "+s);var u=t.substring(i,i+=l);n[r++]="="==o[a].charAt(0)?[DIFF_EQUAL,u]:[DIFF_DELETE,u];break;default:if(o[a])throw new Error("Invalid diff operation in diff_fromDelta: "+o[a])}}if(i!=t.length)throw new Error("Delta length ("+i+") does not equal source text length ("+t.length+").");return n},diff_match_patch.prototype.match_main=function(t,e,n){if(null==t||null==e||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,t.length)),t==e?0:t.length?t.substring(n,n+e.length)==e?n:this.match_bitap_(t,e,n):-1},diff_match_patch.prototype.match_bitap_=function(t,e,n){function r(t,r){var i=t/e.length,a=Math.abs(n-r);return o.Match_Distance?i+a/o.Match_Distance:a?1:i}if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var i=this.match_alphabet_(e),o=this,a=this.Match_Threshold,s=t.indexOf(e,n);-1!=s&&(a=Math.min(r(0,s),a),s=t.lastIndexOf(e,n+e.length),-1!=s&&(a=Math.min(r(0,s),a)));var c=1<<e.length-1;s=-1;for(var l,u,p,h=e.length+t.length,f=0;f<e.length;f++){for(l=0,u=h;u>l;)r(f,n+u)<=a?l=u:h=u,u=Math.floor((h-l)/2+l);h=u;var d=Math.max(1,n-u+1),m=Math.min(n+u,t.length)+e.length,g=Array(m+2);g[m+1]=(1<<f)-1;for(var v=m;v>=d;v--){var y=i[t.charAt(v-1)];if(g[v]=0===f?(1|g[v+1]<<1)&y:(1|g[v+1]<<1)&y|(1|(p[v+1]|p[v])<<1)|p[v+1],g[v]&c){var b=r(f,v-1);if(a>=b){if(a=b,s=v-1,!(s>n))break;d=Math.max(1,2*n-s)}}}if(r(f+1,n)>a)break;p=g}return s},diff_match_patch.prototype.match_alphabet_=function(t){for(var e={},n=0;n<t.length;n++)e[t.charAt(n)]=0;for(var n=0;n<t.length;n++)e[t.charAt(n)]|=1<<t.length-n-1;return e},diff_match_patch.prototype.patch_addContext_=function(t,e){if(0!=e.length){for(var n=e.substring(t.start2,t.start2+t.length1),r=0;e.indexOf(n)!=e.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,n=e.substring(t.start2-r,t.start2+t.length1+r);r+=this.Patch_Margin;var i=e.substring(t.start2-r,t.start2);i&&t.diffs.unshift([DIFF_EQUAL,i]);var o=e.substring(t.start2+t.length1,t.start2+t.length1+r);o&&t.diffs.push([DIFF_EQUAL,o]),t.start1-=i.length,t.start2-=i.length,t.length1+=i.length+o.length,t.length2+=i.length+o.length}},diff_match_patch.prototype.patch_make=function(t,e,n){var r,i;if("string"==typeof t&&"string"==typeof e&&"undefined"==typeof n)r=t,i=this.diff_main(r,e,!0),i.length>2&&(this.diff_cleanupSemantic(i),this.diff_cleanupEfficiency(i));else if(t&&"object"==typeof t&&"undefined"==typeof e&&"undefined"==typeof n)i=t,r=this.diff_text1(i);else if("string"==typeof t&&e&&"object"==typeof e&&"undefined"==typeof n)r=t,i=e;else{if("string"!=typeof t||"string"!=typeof e||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");r=t,i=n}if(0===i.length)return[];for(var o=[],a=new diff_match_patch.patch_obj,s=0,c=0,l=0,u=r,p=r,h=0;h<i.length;h++){var f=i[h][0],d=i[h][1];switch(s||f===DIFF_EQUAL||(a.start1=c,a.start2=l),f){case DIFF_INSERT:a.diffs[s++]=i[h],a.length2+=d.length,p=p.substring(0,l)+d+p.substring(l);break;case DIFF_DELETE:a.length1+=d.length,a.diffs[s++]=i[h],p=p.substring(0,l)+p.substring(l+d.length);break;case DIFF_EQUAL:d.length<=2*this.Patch_Margin&&s&&i.length!=h+1?(a.diffs[s++]=i[h],a.length1+=d.length,a.length2+=d.length):d.length>=2*this.Patch_Margin&&s&&(this.patch_addContext_(a,u),o.push(a),a=new diff_match_patch.patch_obj,s=0,u=p,c=l)}f!==DIFF_INSERT&&(c+=d.length),f!==DIFF_DELETE&&(l+=d.length)}return s&&(this.patch_addContext_(a,u),o.push(a)),o},diff_match_patch.prototype.patch_deepCopy=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],i=new diff_match_patch.patch_obj;i.diffs=[];for(var o=0;o<r.diffs.length;o++)i.diffs[o]=r.diffs[o].slice();i.start1=r.start1,i.start2=r.start2,i.length1=r.length1,i.length2=r.length2,e[n]=i}return e},diff_match_patch.prototype.patch_apply=function(t,e){if(0==t.length)return[e,[]];t=this.patch_deepCopy(t);var n=this.patch_addPadding(t);e=n+e+n,this.patch_splitMax(t);for(var r=0,i=[],o=0;o<t.length;o++){var a,s=t[o].start2+r,c=this.diff_text1(t[o].diffs),l=-1;if(c.length>this.Match_MaxBits?(a=this.match_main(e,c.substring(0,this.Match_MaxBits),s),-1!=a&&(l=this.match_main(e,c.substring(c.length-this.Match_MaxBits),s+c.length-this.Match_MaxBits),(-1==l||a>=l)&&(a=-1))):a=this.match_main(e,c,s),-1==a)i[o]=!1,r-=t[o].length2-t[o].length1;else{i[o]=!0,r=a-s;var u;if(u=-1==l?e.substring(a,a+c.length):e.substring(a,l+this.Match_MaxBits),c==u)e=e.substring(0,a)+this.diff_text2(t[o].diffs)+e.substring(a+c.length);else{var p=this.diff_main(c,u,!1);if(c.length>this.Match_MaxBits&&this.diff_levenshtein(p)/c.length>this.Patch_DeleteThreshold)i[o]=!1;else{this.diff_cleanupSemanticLossless(p);for(var h,f=0,d=0;d<t[o].diffs.length;d++){var m=t[o].diffs[d];m[0]!==DIFF_EQUAL&&(h=this.diff_xIndex(p,f)),m[0]===DIFF_INSERT?e=e.substring(0,a+h)+m[1]+e.substring(a+h):m[0]===DIFF_DELETE&&(e=e.substring(0,a+h)+e.substring(a+this.diff_xIndex(p,f+m[1].length))),m[0]!==DIFF_DELETE&&(f+=m[1].length)}}}}}return e=e.substring(n.length,e.length-n.length),[e,i]},diff_match_patch.prototype.patch_addPadding=function(t){for(var e=this.Patch_Margin,n="",r=1;e>=r;r++)n+=String.fromCharCode(r);for(var r=0;r<t.length;r++)t[r].start1+=e,t[r].start2+=e;var i=t[0],o=i.diffs;if(0==o.length||o[0][0]!=DIFF_EQUAL)o.unshift([DIFF_EQUAL,n]),i.start1-=e,i.start2-=e,i.length1+=e,i.length2+=e;else if(e>o[0][1].length){var a=e-o[0][1].length;o[0][1]=n.substring(o[0][1].length)+o[0][1],i.start1-=a,i.start2-=a,i.length1+=a,i.length2+=a}if(i=t[t.length-1],o=i.diffs,0==o.length||o[o.length-1][0]!=DIFF_EQUAL)o.push([DIFF_EQUAL,n]),i.length1+=e,i.length2+=e;
else if(e>o[o.length-1][1].length){var a=e-o[o.length-1][1].length;o[o.length-1][1]+=n.substring(0,a),i.length1+=a,i.length2+=a}return n},diff_match_patch.prototype.patch_splitMax=function(t){for(var e=this.Match_MaxBits,n=0;n<t.length;n++)if(!(t[n].length1<=e)){var r=t[n];t.splice(n--,1);for(var i=r.start1,o=r.start2,a="";0!==r.diffs.length;){var s=new diff_match_patch.patch_obj,c=!0;for(s.start1=i-a.length,s.start2=o-a.length,""!==a&&(s.length1=s.length2=a.length,s.diffs.push([DIFF_EQUAL,a]));0!==r.diffs.length&&s.length1<e-this.Patch_Margin;){var l=r.diffs[0][0],u=r.diffs[0][1];l===DIFF_INSERT?(s.length2+=u.length,o+=u.length,s.diffs.push(r.diffs.shift()),c=!1):l===DIFF_DELETE&&1==s.diffs.length&&s.diffs[0][0]==DIFF_EQUAL&&u.length>2*e?(s.length1+=u.length,i+=u.length,c=!1,s.diffs.push([l,u]),r.diffs.shift()):(u=u.substring(0,e-s.length1-this.Patch_Margin),s.length1+=u.length,i+=u.length,l===DIFF_EQUAL?(s.length2+=u.length,o+=u.length):c=!1,s.diffs.push([l,u]),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}a=this.diff_text2(s.diffs),a=a.substring(a.length-this.Patch_Margin);var p=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);""!==p&&(s.length1+=p.length,s.length2+=p.length,0!==s.diffs.length&&s.diffs[s.diffs.length-1][0]===DIFF_EQUAL?s.diffs[s.diffs.length-1][1]+=p:s.diffs.push([DIFF_EQUAL,p])),c||t.splice(++n,0,s)}}},diff_match_patch.prototype.patch_toText=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=t[n];return e.join("")},diff_match_patch.prototype.patch_fromText=function(t){var e=[];if(!t)return e;for(var n=t.split("\n"),r=0,i=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<n.length;){var o=n[r].match(i);if(!o)throw new Error("Invalid patch string: "+n[r]);var a=new diff_match_patch.patch_obj;for(e.push(a),a.start1=parseInt(o[1],10),""===o[2]?(a.start1--,a.length1=1):"0"==o[2]?a.length1=0:(a.start1--,a.length1=parseInt(o[2],10)),a.start2=parseInt(o[3],10),""===o[4]?(a.start2--,a.length2=1):"0"==o[4]?a.length2=0:(a.start2--,a.length2=parseInt(o[4],10)),r++;r<n.length;){var s=n[r].charAt(0);try{var c=decodeURI(n[r].substring(1))}catch(l){throw new Error("Illegal escape in patch_fromText: "+c)}if("-"==s)a.diffs.push([DIFF_DELETE,c]);else if("+"==s)a.diffs.push([DIFF_INSERT,c]);else if(" "==s)a.diffs.push([DIFF_EQUAL,c]);else{if("@"==s)break;if(""!==s)throw new Error('Invalid patch mode "'+s+'" in: '+c)}r++}}return e},diff_match_patch.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},diff_match_patch.patch_obj.prototype.toString=function(){var t,e;t=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,e=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var n,r=["@@ -"+t+" +"+e+" @@\n"],i=0;i<this.diffs.length;i++){switch(this.diffs[i][0]){case DIFF_INSERT:n="+";break;case DIFF_DELETE:n="-";break;case DIFF_EQUAL:n=" "}r[i+1]=n+encodeURI(this.diffs[i][1])+"\n"}return r.join("").replace(/%20/g," ")},this.diff_match_patch=diff_match_patch,this.DIFF_DELETE=DIFF_DELETE,this.DIFF_INSERT=DIFF_INSERT,this.DIFF_EQUAL=DIFF_EQUAL,define("dmp",function(t){return function(){var e;return e||t.diff_match_patch}}(this)),define("edit/EditView",["lodash","backbone","edit/templates","jquery","common/utils","common/PromptView","dmp"],function(t,e,n,r,i,o,a){var s=e.View.extend({tagName:"div",id:"editPage",template:n.edit,events:{"click #userName":"changeUserName","change #keyBinding":"changeKeyBinding","change #progLang":"changeProgrammingLanguage","change #editorTheme":"changeEditorTheme","keydown #message":"chat"},initialize:function(e){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change:user",this.updateUserInfo),this.listenTo(this.model,"change:language",this.updateEditorStatus),this.listenTo(this.model,"change:keybindi",this.updateEditorStatus),this.listenTo(this.model,"change:theme",this.updateEditorStatus),this.fileName=e.fileName,this.socket=io.connect("/"),this.socket.on("connect",t.bind(this.onSocketConnect,this)),this.socket.on("socket:new",t.bind(this.onSocketNew,this)),this.socket.on("user:changed",t.bind(this.onUserChange,this)),this.socket.on("message:new",t.bind(this.onNewMessage,this)),this.socket.on("doc:init",t.bind(this.onDocInit,this)),this.socket.on("doc:ack",t.bind(this.onDocAck,this)),this.socket.on("doc:changed",t.bind(this.onDocRemoteChanged,this)),this.socket.on("doc:sync",t.bind(this.onDocSync,this)),this.dmp=new a,this.opMap={insertText:1,insertLines:1,removeText:-1,removeLines:-1},this.changeArr=[]},render:function(t){if(!this.rendered){this.$el.html(this.template(this.model.toJSON()));var e=this;"undefined"==typeof ace?i.loadScript("/ace-builds-1.1.01/src-noconflict/ace.js",function(){e.initEditor()}):e.initEditor(),t.get("user")||(this.$("#userName").html("unknown"),this.changeUserName()),this.rendered=!0}},initEditor:function(){window.aceEditor=this.editor=ace.edit(this.$("#editor")[0]),this.$(".messages .panel-body").height(r(window).height()-421),this.$("#editor").height(r(".sidebar").height()),this.updateEditorStatus(),this.editor.focus(),i.loadScript("/ace-builds-1.1.01/src-min-noconflict/keybinding-emacs.js",function(){}),i.loadScript("/ace-builds-1.1.01/src-min-noconflict/keybinding-vim.js",function(){}),this.editor.on("change",t.bind(this.onEditorChange,this)),this.doc=this.editor.getSession().doc},updateEditorStatus:function(){if(this.editor){this.editor.setTheme(this.model.get("theme")),this.editor.getSession().setMode("ace/mode/"+this.model.get("language"));var t=this.model.get("keybindi");this.editor.setKeyboardHandler(t?"ace/keyboard/"+t:null)}},updateUserInfo:function(){var t=this.model.get("user")||"unknown";this.$("#userName").html(t),this.socket.emit("username:change",{user:t})},changeUserName:function(){var t=this;new o({title:"RealEdit",prompt:"Please enter your user name:",callback:function(e){var n=t.$("#userName").html();t.model.set("user",e||n||""),e&&(localStorage.realEditUser=e)}})},changeKeyBinding:function(){var t=localStorage.realEditKeyBindi=this.$("#keyBinding").val();this.model.set("keybindi",t)},changeProgrammingLanguage:function(){var t=localStorage.realEditProgLang=this.$("#progLang").val();this.model.set("language",t)},changeEditorTheme:function(){var t=localStorage.realEditTheme=this.$("#editorTheme").val();this.model.set("theme",t)},chat:function(t){if(13==t.which){var e=r.trim(this.$("#message").val());this.socket.emit("chat",{chanel:this.fileName,msg:e,user:this.model.get("user")||"unknown"}),this.$("#message").val("")}},onSocketConnect:function(){this.socket.emit("begin",{chanel:this.fileName,user:this.model.get("user")||"unknown"})},onSocketNew:function(t){this.socket.id=t},onNewMessage:function(t){this.$("#msgList").append(n["edit/message"](t)),r(".messages .always-into-view")[0].scrollIntoView()},onUserChange:function(t){this.$("#usersList").html(n["edit/users"]({users:t})),r(".user-list .always-into-view")[0].scrollIntoView(),r("#userNum").html(t.length)},onEditorChange:function(e){if(!this.dontChange){var n=e.data,r=this.opMap[n.action],i=this.getModifyRange(n),o=[t.uniqueId("c"),r,i.start,i.end,i.text];this.changeArr.push(o),this.sendChange()}},sendChange:function(){return this.pending?(console.log("pending now, please wait..."),void 0):(this.socket.emit("doc:change",{cr:this.curRevision,cg:this.changeArr}),this.pending=!0,void 0)},onDocInit:function(t){this.curRevision=t.r,this.curRevText=t.c,this.dontChange=!0,this.doc.setValue(t.c),this.dontChange=!1},onDocAck:function(e){var n=this.curRevision<e.nr&&this.curRevision==e.or&&!e.ph,r=e.id,o=this.changeArr;this.changeArr=t.filter(o,function(t){return-1==r.indexOf(t[0])}),n&&(console.log("update to revision: ",e.nr),this.curRevision=e.nr,this.curRevText=i.merge(this.curRevText,e.cg)),this.pending=!1,this.changeArr.length>0&&this.sendChange()},onDocRemoteChanged:function(t){if(t.fr!=this.socket.id){var e=t.nr,n=t.or,r=t.cg,o=t.ph,a=this.curRevision;if(a==e)console.log("already newest");else if(e>a&&a==n){console.log("can merge");var s=this.doc.getValue(),c=s;this.dontChange=!0,c=o?this.dmp.patch_apply(o,s)[0]:i.merge(s,r),this.doc.setValue(c),this.dontChange=!1,this.curRevision=e}else a>e?console.log("old revision arrived, ignore that"):(this.syncLatestRevision(),console.log("need sync"))}},syncLatestRevision:function(){this.socket.emit("doc:needSync",this.curRevision)},onDocSync:function(e){console.log("doc sync: ",e);var n=e.rs,r=this.curRevText,o=this.curRevision;o!=e.or,this.dontChange=!0,t.each(n,function(t){console.log("rev: ",t),t.r>o&&(r=t.p?this.dmp.patch_apply(t.g,r)[0]:i.merge(r,t.g))},this),console.log("newText: ",r),this.doc.setValue(r),this.dontChange=!1},getModifyRange:function(e){var n=this.doc.positionToIndex(e.range.start),r=n,i="",o=this.doc.getNewLineCharacter();if("removeLines"==e.action||"insertLines"==e.action){var a=e.lines.length*o.length,s=0;t.each(e.lines,function(t){s+=t.length,i+=t+o}),r=n+s+a}else r=n+e.text.length,i=e.text;return{start:n,end:r,text:i}}});return s}),define("edit/main",["./EditView","app","backbone","jquery","common/utils","common/PromptView","socket.io"],function(t,e,n,r){return function(i,o,a,s){var c=new n.Model,l=new t({model:c,fileName:s});e.views.push(l),r("#main").append(l.el),c.set({user:localStorage.realEditUser||"",language:localStorage.realEditProgLang||"javascript",keybindi:localStorage.realEditKeyBindi||"",theme:localStorage.realEditTheme||"textmate"})}});
//@ sourceMappingURL=main.js.map